{"addrs":["0.0.0.0:8181"],"diagnostic-addrs":[],"level":"info","msg":"Initializing server.","time":"2025-06-03T09:40:46Z"}
{"level":"debug","msg":"Failed to determine uid/gid of process owner","time":"2025-06-03T09:40:46Z"}
{"level":"debug","msg":"maxprocs: Leaving GOMAXPROCS=6: CPU quota undefined","time":"2025-06-03T09:40:46Z"}
{"headers":{"Content-Type":["application/json"],"User-Agent":["Open Policy Agent/1.3.0 (linux, amd64)"]},"level":"debug","method":"POST","msg":"Sending request.","time":"2025-06-03T09:40:46Z","url":"https://telemetry.openpolicyagent.org/v1/version"}
{"level":"debug","msg":"Server initialized.","time":"2025-06-03T09:40:46Z"}
{"headers":{"Content-Length":["191"],"Content-Type":["application/json"],"Date":["Tue, 03 Jun 2025 09:40:54 GMT"]},"level":"debug","method":"POST","msg":"Received response.","status":"200 OK","time":"2025-06-03T09:40:48Z","url":"https://telemetry.openpolicyagent.org/v1/version"}
{"current_version":"1.3.0","download_opa":"https://openpolicyagent.org/downloads/v1.5.0/opa_linux_amd64","latest_version":"1.5.0","level":"info","msg":"OPA is out of date.","release_notes":"https://github.com/open-policy-agent/opa/releases/tag/v1.5.0","time":"2025-06-03T09:40:48Z"}
{"client_addr":"127.0.0.1:55114","level":"info","msg":"Received request.","req_body":"package httpapi.authz\n\ndefault allow := false\n\n# Consentito se amministratore con tutte le azioni\nallow if {\n    is_amministratore\n}\n\n# Consentito se medico e non cancella bucket\nallow if {\n    is_medico\n    input.input.action != \"s3:DeleteBucket\"\n}\n\n# Consentito se segretario e solo in lettura\nallow if {\n    is_segreteria\n    input.input.action in read_only_actions\n}\n\n# Consentito se paziente e il documento Ã¨ intestato a lui\nallow if {\n    is_paziente\n    input.input.action in read_only_actions\n    document_intestato_all_utente\n}\n\n# Account di servizio MinIO\nallow if {\n    input.input.account == \"minio\"\n}\n\n# Helper per controllare il gruppo\nis_amministratore if {\n    \"amministratori\" in input.input.claims.policy\n}\n\nis_medico if {\n    \"medici\" in input.input.claims.policy\n}\n\nis_segreteria if {\n    \"segreteria\" in input.input.claims.policy\n}\n\nis_paziente if {\n    \"pazienti\" in input.input.claims.policy\n}\n\n# Controlla se l'oggetto contiene il nome dell'utente (MIGLIORATA)\ndocument_intestato_all_utente if {\n    family_name := lower(input.input.claims.family_name)\n    given_name := lower(input.input.claims.given_name)\n    object_name := lower(input.input.object)\n    \n    # Verifica diverse combinazioni nome-cognome\n    contains(object_name, sprintf(\"%s_%s\", [family_name, given_name]))\n}\n\ndocument_intestato_all_utente if {\n    family_name := lower(input.input.claims.family_name)\n    given_name := lower(input.input.claims.given_name)\n    object_name := lower(input.input.object)\n    \n    # Verifica anche cognome-nome\n    contains(object_name, sprintf(\"%s_%s\", [given_name, family_name]))\n}\n\n# Lista completa delle azioni S3 di sola lettura\nread_only_actions := {\n    # Listing generale\n    \"s3:ListAllMyBuckets\",\n    \"s3:GetService\",\n    \n    # Bucket operations (read)\n    \"s3:ListBucket\",\n    \"s3:ListBucketVersions\",\n    \"s3:ListBucketMultipartUploads\",\n    \"s3:GetBucketLocation\",\n    \"s3:GetBucketVersioning\",\n    \"s3:GetBucketAcl\",\n    \"s3:GetBucketCORS\",\n    \"s3:GetBucketPolicy\",\n    \"s3:GetBucketLogging\",\n    \"s3:GetBucketNotification\",\n    \"s3:GetBucketTagging\",\n    \"s3:GetBucketWebsite\",\n    \"s3:GetBucketInventory\",\n    \"s3:GetBucketMetrics\",\n    \"s3:GetBucketAnalytics\",\n    \"s3:GetBucketAccelerateConfiguration\",\n    \"s3:GetBucketRequestPayment\",\n    \"s3:GetBucketReplication\",\n    \"s3:GetBucketEncryption\",\n    \"s3:GetBucketLifecycleConfiguration\",\n    \"s3:HeadBucket\",\n    \n    # Object operations (read)\n    \"s3:GetObject\",\n    \"s3:GetObjectVersion\",\n    \"s3:GetObjectAcl\",\n    \"s3:GetObjectVersionAcl\",\n    \"s3:GetObjectTagging\",\n    \"s3:GetObjectVersionTagging\",\n    \"s3:GetObjectTorrent\",\n    \"s3:GetObjectRetention\",\n    \"s3:GetObjectLegalHold\",\n    \"s3:HeadObject\",\n    \n    # Multipart operations (read)\n    \"s3:ListMultipartUploadParts\",\n    \n    # Query operations\n    \"s3:SelectObjectContent\",\n}","req_id":1,"req_method":"PUT","req_params":{},"req_path":"/v1/policies/opa/prova/main","time":"2025-06-03T09:41:05Z"}
{"client_addr":"127.0.0.1:55114","level":"info","msg":"Sent response.","req_id":1,"req_method":"PUT","req_path":"/v1/policies/opa/prova/main","resp_body":"{}\n","resp_bytes":3,"resp_duration":3.775481,"resp_status":200,"time":"2025-06-03T09:41:05Z"}
{"client_addr":"10.244.0.6:55392","level":"info","msg":"Received request.","req_body":"","req_id":23,"req_method":"POST","req_params":{},"req_path":"/v1/data/httpapi/authz/allow","time":"2025-06-03T09:42:56Z"}
{"client_addr":"10.244.0.6:55392","level":"info","msg":"Sent response.","req_id":23,"req_method":"POST","req_path":"/v1/data/httpapi/authz/allow","resp_body":"{\"result\":false,\"warning\":{\"code\":\"api_usage_warning\",\"message\":\"'input' key missing from the request\"}}\n","resp_bytes":105,"resp_duration":0.582846,"resp_status":200,"time":"2025-06-03T09:42:56Z"}
{"client_addr":"10.244.0.6:47830","level":"info","msg":"Received request.","req_body":"{\"input\":{\"account\":\"86P89NV0DGE6KBV3RKGV\",\"groups\":null,\"action\":\"s3:ListAllMyBuckets\",\"originalAction\":\"\",\"bucket\":\"\",\"conditions\":{\"Accept-Encoding\":[\"identity\"],\"Authorization\":[\"AWS4-HMAC-SHA256 Credential=86P89NV0DGE6KBV3RKGV/20250603/us-east-1/s3/aws4_request, SignedHeaders=host;x-amz-content-sha256;x-amz-date;x-amz-security-token, Signature=afed916e9db9d92e02f7901a5d664211ab4230c001614b93194ee3eb434a8115\"],\"CurrentTime\":[\"2025-06-03T10:27:36Z\"],\"EpochTime\":[\"1748946456\"],\"Referer\":[\"\"],\"SecureTransport\":[\"true\"],\"SourceIp\":[\"192.168.49.1\"],\"User-Agent\":[\"MinIO (Linux; x86_64) minio-py/7.2.15\"],\"UserAgent\":[\"MinIO (Linux; x86_64) minio-py/7.2.15\"],\"X-Amz-Content-Sha256\":[\"UNSIGNED-PAYLOAD\"],\"X-Amz-Date\":[\"20250603T102736Z\"],\"X-Amz-Security-Token\":[\"eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NLZXkiOiI4NlA4OU5WMERHRTZLQlYzUktHViIsImFjciI6IjEiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9taW5pby1jb25zb2xlLmxvY2FsIl0sImF1ZCI6ImFjY291bnQiLCJhenAiOiJtaW5pby1jbGllbnQiLCJlbWFpbCI6ImFtbWluaXN0cmF0b3JlQHRlc3QuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImV4cCI6MTc0OTAzMjQ1MCwiZmFtaWx5X25hbWUiOiJBbW1pbmlzdHJhdG9yZSIsImdpdmVuX25hbWUiOiJBbW1pbmlzdHJhdG9yZSIsImlhdCI6MTc0ODk0NjQ1MCwiaXNzIjoiaHR0cHM6Ly9rZXljbG9hay5sb2NhbC9yZWFsbXMvTWluSU8iLCJqdGkiOiJkM2EzZmZlNC1mZjAyLTQ1NzYtOGRmNy0xODM1MThjOGU0YzciLCJuYW1lIjoiQW1taW5pc3RyYXRvcmUgQW1taW5pc3RyYXRvcmUiLCJwb2xpY3kiOlsiY29uc29sZUFkbWluIiwiYW1taW5pc3RyYXRvcmkiXSwicHJlZmVycmVkX3VzZXJuYW1lIjoiYW1taW5pc3RyYXRvcmUiLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsiZGVmYXVsdC1yb2xlcy1taW5pbyIsIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJyb2xlQXJuIjoiYXJuOm1pbmlvOmlhbTo6OnJvbGUvMW1Bc3FwVUdveDhlZXdlcERRMWRtdHdwZFk4Iiwic2NvcGUiOiJvcGVuaWQgbWluaW8tYXV0aG9yaXphdGlvbiBlbWFpbCBwcm9maWxlIiwic2lkIjoiZTM2M2M5YWItNTlkZS00MjI0LWFkYTEtMGVmN2RmN2Q5YjQwIiwic3ViIjoiYzVkZTI3YzAtYjUwZi00YTk4LWE2ZTctYWIxNDY2OGRmYjU4IiwidHlwIjoiQmVhcmVyIn0.DnbKpSpq6pduZOvWnDLWejfXyBjz21DZSiTz5tXiFeH6fWg51NkHbeOgao-nF-XfvADno_VccDEIVBbMV-AAHA\"],\"X-Forwarded-For\":[\"192.168.49.1\"],\"X-Forwarded-Host\":[\"minio-api.local\"],\"X-Forwarded-Port\":[\"443\"],\"X-Forwarded-Proto\":[\"https\"],\"X-Forwarded-Scheme\":[\"https\"],\"X-Real-Ip\":[\"192.168.49.1\"],\"X-Request-Id\":[\"7ab838764901846712c2b4533c9ac3ed\"],\"X-Scheme\":[\"https\"],\"accesskey\":[\"86P89NV0DGE6KBV3RKGV\"],\"acr\":[\"1\"],\"aud\":[\"account\"],\"authType\":[\"REST-HEADER\"],\"azp\":[\"minio-client\"],\"email\":[\"amministratore@test.com\"],\"family_name\":[\"Amministratore\"],\"given_name\":[\"Amministratore\"],\"iss\":[\"https://keycloak.local/realms/MinIO\"],\"jti\":[\"d3a3ffe4-ff02-4576-8df7-183518c8e4c7\"],\"name\":[\"Amministratore Amministratore\"],\"preferred_username\":[\"amministratore\"],\"principaltype\":[\"AssumedRole\"],\"rolearn\":[\"arn:minio:iam:::role/1mAsqpUGox8eewepDQ1dmtwpdY8\"],\"scope\":[\"openid minio-authorization email profile\"],\"sid\":[\"e363c9ab-59de-4224-ada1-0ef7df7d9b40\"],\"signatureversion\":[\"AWS4-HMAC-SHA256\"],\"sub\":[\"c5de27c0-b50f-4a98-a6e7-ab14668dfb58\"],\"typ\":[\"Bearer\"],\"userid\":[\"jBKFKeyW-9kM9f0ypIc-UaZsvRBJMHOu_KUIo041yYI\"],\"username\":[\"jBKFKeyW-9kM9f0ypIc-UaZsvRBJMHOu_KUIo041yYI\"],\"versionid\":[\"\"]},\"owner\":false,\"object\":\"\",\"claims\":{\"accessKey\":\"86P89NV0DGE6KBV3RKGV\",\"acr\":\"1\",\"allowed-origins\":[\"https://minio-console.local\"],\"aud\":\"account\",\"azp\":\"minio-client\",\"email\":\"amministratore@test.com\",\"email_verified\":true,\"exp\":1749032450,\"family_name\":\"Amministratore\",\"given_name\":\"Amministratore\",\"iat\":1748946450,\"iss\":\"https://keycloak.local/realms/MinIO\",\"jti\":\"d3a3ffe4-ff02-4576-8df7-183518c8e4c7\",\"name\":\"Amministratore Amministratore\",\"policy\":[\"consoleAdmin\",\"amministratori\"],\"preferred_username\":\"amministratore\",\"realm_access\":{\"roles\":[\"default-roles-minio\",\"offline_access\",\"uma_authorization\"]},\"resource_access\":{\"account\":{\"roles\":[\"manage-account\",\"manage-account-links\",\"view-profile\"]}},\"roleArn\":\"arn:minio:iam:::role/1mAsqpUGox8eewepDQ1dmtwpdY8\",\"scope\":\"openid minio-authorization email profile\",\"sid\":\"e363c9ab-59de-4224-ada1-0ef7df7d9b40\",\"sub\":\"c5de27c0-b50f-4a98-a6e7-ab14668dfb58\",\"typ\":\"Bearer\"},\"denyOnly\":false}}","req_id":202,"req_method":"POST","req_params":{},"req_path":"/v1/data/httpapi/authz/allow","time":"2025-06-03T10:27:36Z"}
{"client_addr":"10.244.0.6:47830","level":"info","msg":"Sent response.","req_id":202,"req_method":"POST","req_path":"/v1/data/httpapi/authz/allow","resp_body":"{\"result\":false}\n","resp_bytes":17,"resp_duration":28.43826,"resp_status":200,"time":"2025-06-03T10:27:36Z"}